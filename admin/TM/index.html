<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style1.css" />
    <link rel="stylesheet" href="css/viewprofile.css" />
    <title>Traffic and Transport Management - Traffic Monitoring</title>
    <style>
      /* Traffic Monitoring Specific Styles */
      .traffic-status-card {
        border-left: 4px solid;
        transition: all 0.3s;
        border-radius: 8px;
        background: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      }
      
      .traffic-status-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      }
      
      .traffic-low {
        border-left-color: #06d6a0;
        background: linear-gradient(to right, rgba(6, 214, 160, 0.05), white);
      }
      
      .traffic-medium {
        border-left-color: #ffd166;
        background: linear-gradient(to right, rgba(255, 209, 102, 0.05), white);
      }
      
      .traffic-high {
        border-left-color: #e63946;
        background: linear-gradient(to right, rgba(230, 57, 70, 0.05), white);
      }
      
      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 5px;
      }
      
      .status-low {
        background-color: #06d6a0;
      }
      
      .status-medium {
        background-color: #ffd166;
      }
      
      .status-high {
        background-color: #e63946;
      }
      
      .traffic-form {
        background: white;
        border-radius: 10px;
        padding: 2rem;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        border-top: 3px solid #1d3557;
      }
      
      .report-table {
        max-height: 500px;
        overflow-y: auto;
      }
      
      .tab-content {
        padding: 20px;
        background: white;
        border-radius: 0 0 10px 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      }
      
      .tab-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }
      
      .tab-button {
        padding: 10px 20px;
        background: #f8f9fa;
        border: none;
        border-radius: 5px 5px 0 0;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 14px;
      }
      
      .tab-button:hover {
        background: #e9ecef;
      }
      
      .tab-button.active {
        background: #1d3557;
        color: white;
      }
      
      .traffic-signal {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto;
        color: white;
        font-weight: bold;
        font-size: 12px;
      }

      .stats-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        text-align: center;
        border-top: 3px solid #1d3557;
      }

      .stat-card h3 {
        font-size: 14px;
        color: #666;
        margin-bottom: 10px;
      }

      .stat-card p {
        font-size: 24px;
        font-weight: bold;
        color: #1d3557;
        margin: 0;
      }

      .chart-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .chart {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }

      .response-time {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        text-align: center;
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0,0,0,0.9);
      }

      .modal-content {
        margin: auto;
        display: block;
        width: 80%;
        max-width: 700px;
        max-height: 80%;
      }

      .close {
        position: absolute;
        top: 15px;
        right: 35px;
        color: #f1f1f1;
        font-size: 40px;
        font-weight: bold;
        cursor: pointer;
      }

      .close:hover {
        color: #bbb;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .tab-buttons {
          flex-direction: column;
        }
        
        .tab-button {
          width: 100%;
          text-align: center;
        }
        
        .chart-container {
          grid-template-columns: 1fr;
        }
        
        .stats-container {
          grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        }
      }
    </style>
  </head>
  <body>
    <div id="avatarModal" class="modal">
      <span class="close">&times;</span>
      <img class="modal-content" id="modalImage" />
    </div>

    <section id="sidebar">
      <a href="#" class="brand">
        <img
          src="/placeholder.svg?height=40&width=40"
          alt="Profile Photo"
          class="profile-avatar"
          id="profileAvatar"
          style="cursor: pointer; transition: transform 0.2s"
        />
        <span class="text">Traffic And Transport Management</span>
      </a>
      <ul class="side-menu top">
        <li>
          <a href="index.html">
            <i class="bx bxs-dashboard"></i>
            <span class="text">Dashboard</span>
          </a>
        </li>
        <span class="separator">Main</span>
        
        <li class="active">
          <a href="index.html">
            <i class="bx bx-car"></i>
            <span class="text">Traffic Monitoring</span>
          </a>
        </li>
        <li>
          <a href="../RTR/index.html">
            <i class="bx bx-flame"></i>
            <span class="text">Real-Time Road Updates</span>
          </a>
        </li>
        <li>
          <a href="../AVR/index.html">
            <i class="bx bx-bell"></i>
            <span class="text">Accident & Violation Reports</span>
          </a>
        </li>
        <li>
          <a href="../VRD/index.html">
            <i class="bx bx-user"></i>
            <span class="text">Vehicle Routing & Diversion</span>
          </a>
        </li>
        <li>
          <a href="../TSC/index.html">
            <i class="bx bx-bar-chart-big"></i>
            <span class="text">Traffic Signal Control</span>
          </a>
        </li>
        <li>
          <a href="../PTS/index.html">
            <i class="bx bx-megaphone-alt"></i>
            <span class="text">Public Transport Sync</span>
          </a>
        </li>
        <li>
          <a href="../PATS/index.html">
            <i class="bx bx-heart-plus"></i>
            <span class="text">Permit & Ticketing System</span>
          </a>
        </li>
      </ul>
      <ul class="side-menu">
        <span class="separator">SETTINGS</span>
        <li>
          <a href="Profile.html">
            <i class="bx bxs-user-pin"></i>
            <span class="text">Profile</span>
          </a>
        </li>
        <li>
          <a href="Settings.html">
            <i class="bx bxs-cog"></i>
            <span class="text">Settings</span>
          </a>
        </li>
        <li>
          <a href="#" class="logout">
            <i class="bx bxs-log-out-circle"></i>
            <span class="text">Logout</span>
          </a>
        </li>
      </ul>
    </section>

    <section id="content">
      <nav>
        <a href="#" class="nav-link">Categories</a>
        <form action="#">
          <div class="form-input">
            <input type="search" placeholder="Search..." />
            <button type="submit" class="search-btn">
              <i class="bx bx-search"></i>
            </button>
          </div>
        </form>
        <a href="#" class="notification">
          <i class="bx bxs-bell"></i>
          <span class="num">9+</span>
        </a>
        <div class="profile-dropdown">
          <a href="#" class="profile" id="profile-btn">
            <img src="/placeholder.svg?height=40&width=40" />
          </a>
          <div class="dropdown-menu" id="dropdown-menu">
            <a href="Profile.html">Profile</a>
            <a href="Settings.html">Settings</a>
          </div>
        </div>
      </nav>

      <main>
        <div class="head-title">
          <div class="left">
            <h1>Traffic Monitoring</h1>
            <ul class="breadcrumb">
              <li>
                <a href="#">Dashboard</a>
              </li>
              <li><i class="bx bx-chevron-right"></i></li>
              <li>
                <a class="active" href="#">Traffic Monitoring</a>
              </li>
            </ul>
          </div>
        </div>
        
        <div class="tab-buttons">
          <button class="tab-button active" onclick="openTab(event, 'dashboard')">
            <i class="bx bxs-dashboard"></i> Dashboard
          </button>
          <button class="tab-button" onclick="openTab(event, 'manual_traffic_log')">
            <i class="bx bx-edit"></i> Manual Traffic Log
          </button>
          <button class="tab-button" onclick="openTab(event, 'traffic_volume_status')">
            <i class="bx bx-traffic-cone"></i> Traffic Volume Status
          </button>
          <button class="tab-button" onclick="openTab(event, 'daily_monitoring_report')">
            <i class="bx bx-file"></i> Daily Monitoring Report
          </button>
        </div>
        
         Dashboard Tab 
        <div id="dashboard" class="tab-content" style="display: block;">
          <div class="dashboard-overview">
            <h2>Traffic Monitoring Dashboard Overview</h2>
            
            <div class="stats-container">
              <div class="stat-card">
                <h3>Active Traffic Incidents</h3>
                <p id="activeIncidents">8</p>
              </div>
              <div class="stat-card">
                <h3>Congestion Points</h3>
                <p id="congestionPoints">3</p>
              </div>
              <div class="stat-card">
                <h3>Average Speed</h3>
                <p id="averageSpeed">32 km/h</p>
              </div>
              <div class="stat-card">
                <h3>Total Logs Today</h3>
                <p id="totalLogs">0</p>
              </div>
            </div>

            <div class="chart-container">
              <div class="chart">
                <h3>Traffic Volume Trends (Last 24 Hours)</h3>
                <canvas id="trafficTrendChart"></canvas>
              </div>
              <div class="chart">
                <h3>Traffic Status Distribution</h3>
                <canvas id="statusDistributionChart"></canvas>
              </div>
            </div>

            <div class="response-time">
              <h3>Peak Traffic Hours</h3>
              <p>7:30-9:30 AM | 4:30-7:00 PM</p>
              <div style="width: 80%; margin: 0 auto">
                <canvas id="peakHoursChart"></canvas>
              </div>
            </div>
          </div>
        </div>
        
         Manual Traffic Log Tab 
        <div id="manual_traffic_log" class="tab-content" style="display: none;">
          <div class="row">
            <div class="col-md-6">
              <div class="traffic-form">
                <h4><i class="bx bx-edit"></i> Create Traffic Log</h4>
                <form id="trafficLogForm">
                  <div class="mb-3">
                    <label class="form-label">Location *</label>
                    <input type="text" class="form-control" id="location" placeholder="Enter location or intersection" required>
                  </div>
                  
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label class="form-label">Date *</label>
                      <input type="date" class="form-control" id="logDate" required>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Time *</label>
                      <input type="time" class="form-control" id="logTime" required>
                    </div>
                  </div>
                  
                  <div class="mb-3">
                    <label class="form-label">Traffic Status *</label>
                    <select class="form-select" id="trafficStatus" required>
                      <option value="">Select traffic status</option>
                      <option value="low">Low - Free flowing traffic</option>
                      <option value="medium">Medium - Moderate congestion</option>
                      <option value="high">High - Heavy congestion</option>
                    </select>
                  </div>
                  
                  <div class="mb-3">
                    <label class="form-label">Additional Notes</label>
                    <textarea class="form-control" id="notes" rows="3" placeholder="Any additional details about traffic conditions"></textarea>
                  </div>
                  
                  <button type="submit" class="btn btn-primary">
                    <i class="bx bx-save"></i> Save Log
                  </button>
                  <button type="reset" class="btn btn-outline-secondary ms-2">
                    <i class="bx bx-reset"></i> Reset
                  </button>
                </form>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="traffic-form">
                <h4><i class="bx bx-map"></i> Recent Traffic Logs</h4>
                <div class="report-table">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>Location</th>
                        <th>Date/Time</th>
                        <th>Status</th>
                        <th>Action</th>
                      </tr>
                    </thead>
                    <tbody id="recentLogsTable">
                       Logs will be populated here 
                    </tbody>
                  </table>
                </div>
                <div class="alert alert-info mt-3">
                  <i class="bx bx-info-circle"></i> Logs are saved to your browser's local storage.
                </div>
              </div>
            </div>
          </div>
        </div>
        
         Traffic Volume Status Tab 
        <div id="traffic_volume_status" class="tab-content" style="display: none;">
          <div class="row">
            <div class="col-md-4">
              <div class="traffic-form">
                <h4><i class="bx bx-traffic-cone"></i> Traffic Status Overview</h4>
                
                <div class="traffic-status-card traffic-low p-3 mb-3">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h5>Main Highway</h5>
                      <p class="mb-0">Free flowing traffic</p>
                      <small class="text-muted">Speed: 60-80 km/h</small>
                    </div>
                    <div class="traffic-signal" style="background-color: #06d6a0;">
                      LOW
                    </div>
                  </div>
                </div>
                
                <div class="traffic-status-card traffic-medium p-3 mb-3">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h5>Downtown Area</h5>
                      <p class="mb-0">Moderate congestion</p>
                      <small class="text-muted">Speed: 30-50 km/h</small>
                    </div>
                    <div class="traffic-signal" style="background-color: #ffd166;">
                      MEDIUM
                    </div>
                  </div>
                </div>
                
                <div class="traffic-status-card traffic-high p-3 mb-3">
                  <div class="d-flex justify-content-between align-items-center">
                    <div>
                      <h5>Central Intersection</h5>
                      <p class="mb-0">Heavy congestion</p>
                      <small class="text-muted">Speed: 10-30 km/h</small>
                    </div>
                    <div class="traffic-signal" style="background-color: #e63946;">
                      HIGH
                    </div>
                  </div>
                </div>

                <div class="mt-3">
                  <h6>Traffic Level Definitions:</h6>
                  <ul class="list-unstyled">
                    <li><span class="status-indicator status-low"></span> <strong>Low:</strong> Free flowing, minimal delays</li>
                    <li><span class="status-indicator status-medium"></span> <strong>Medium:</strong> Some congestion, moderate delays</li>
                    <li><span class="status-indicator status-high"></span> <strong>High:</strong> Heavy congestion, significant delays</li>
                  </ul>
                </div>
              </div>
            </div>
            
            <div class="col-md-8">
              <div class="traffic-form">
                <h4><i class="bx bx-map-alt"></i> Traffic Status Map</h4>
                <div style="height: 400px; background-color: #f5f5f5; border-radius: 10px; display: flex; align-items: center; justify-content: center; position: relative;">
                  <div style="text-align: center;">
                    <i class="bx bx-map" style="font-size: 3rem; color: #ccc;"></i>
                    <p>Interactive traffic status map would appear here</p>
                    <small class="text-muted">Real-time traffic monitoring visualization</small>
                  </div>
                </div>
                
                <div class="mt-3">
                  <button class="btn btn-outline-primary" onclick="refreshTrafficStatus()">
                    <i class="bx bx-refresh"></i> Refresh Status
                  </button>
                  <button class="btn btn-outline-secondary ms-2" onclick="filterLocations()">
                    <i class="bx bx-filter"></i> Filter Locations
                  </button>
                  <button class="btn btn-outline-info ms-2" onclick="toggleMapView()">
                    <i class="bx bx-layer"></i> Toggle View
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
        
         Daily Monitoring Report Tab 
        <div id="daily_monitoring_report" class="tab-content" style="display: none;">
          <div class="row">
            <div class="col-md-12">
              <div class="traffic-form">
                <div class="d-flex justify-content-between align-items-center mb-3 flex-wrap">
                  <h4><i class="bx bx-file"></i> Daily Traffic Monitoring Report</h4>
                  <div class="mt-2 mt-md-0">
                    <button class="btn btn-sm btn-outline-secondary" onclick="filterReports()">
                      <i class="bx bx-filter"></i> Filter
                    </button>
                    <button class="btn btn-sm btn-outline-primary ms-2" onclick="exportToPDF()">
                      <i class="bx bx-download"></i> Export PDF
                    </button>
                    <button class="btn btn-sm btn-outline-secondary ms-2" onclick="printReport()">
                      <i class="bx bx-printer"></i> Print
                    </button>
                    <button class="btn btn-sm btn-outline-danger ms-2" onclick="clearAllLogs()">
                      <i class="bx bx-trash"></i> Clear All
                    </button>
                  </div>
                </div>
                
                <div class="report-table">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>Location</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Status</th>
                        <th>Notes</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="reportTable">
                       Reports will be populated here 
                    </tbody>
                  </table>
                </div>
                
                <div class="alert alert-info mt-3">
                  <i class="bx bx-info-circle"></i> Showing all traffic monitoring data. Use filters to narrow down results.
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </section>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script>
      // Initialize the application
      document.addEventListener('DOMContentLoaded', function() {
        // Set current date and time as default
        const now = new Date();
        document.getElementById('logDate').value = now.toISOString().split('T')[0];
        document.getElementById('logTime').value = now.toTimeString().slice(0, 5);
        
        // Load initial data
        updateDashboardStats();
        initializeCharts();
        loadRecentLogs();
      });

      // Tab functionality
      function openTab(evt, tabName) {
        var i, tabcontent, tabbuttons;
        
        // Hide all tab content
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
        }
        
        // Remove active class from all buttons
        tabbuttons = document.getElementsByClassName("tab-button");
        for (i = 0; i < tabbuttons.length; i++) {
          tabbuttons[i].classList.remove("active");
        }
        
        // Show the current tab and add active class to the button
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.classList.add("active");
        
        // Load data when tabs are clicked
        if(tabName === 'manual_traffic_log') {
          loadRecentLogs();
        } else if(tabName === 'daily_monitoring_report') {
          loadReports();
        } else if(tabName === 'dashboard') {
          updateDashboardStats();
        }
      }

      // Traffic Log Form Handling
      document.getElementById('trafficLogForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form values
        const location = document.getElementById('location').value.trim();
        const date = document.getElementById('logDate').value;
        const time = document.getElementById('logTime').value;
        const status = document.getElementById('trafficStatus').value;
        const notes = document.getElementById('notes').value.trim();
        
        // Validate required fields
        if (!location || !date || !time || !status) {
          alert('Please fill in all required fields.');
          return;
        }
        
        // Create log object
        const logEntry = {
          id: Date.now(), // Simple ID generation
          location,
          date,
          time,
          status,
          notes,
          timestamp: new Date().getTime()
        };
        
        // Save to localStorage
        saveLog(logEntry);
        
        // Reset form
        this.reset();
        
        // Set current date and time again
        const now = new Date();
        document.getElementById('logDate').value = now.toISOString().split('T')[0];
        document.getElementById('logTime').value = now.toTimeString().slice(0, 5);
        
        // Show success message
        showNotification('Traffic log saved successfully!', 'success');
        
        // Refresh recent logs and dashboard
        loadRecentLogs();
        updateDashboardStats();
      });

      // Save log to localStorage
      function saveLog(logEntry) {
        let logs = JSON.parse(localStorage.getItem('trafficLogs')) || [];
        logs.push(logEntry);
        localStorage.setItem('trafficLogs', JSON.stringify(logs));
      }

      // Load recent logs
      function loadRecentLogs() {
        const logs = JSON.parse(localStorage.getItem('trafficLogs')) || [];
        const recentLogsTable = document.getElementById('recentLogsTable');
        recentLogsTable.innerHTML = '';
        
        // Sort by timestamp (newest first) and get last 5
        const recentLogs = logs.sort((a, b) => b.timestamp - a.timestamp).slice(0, 5);
        
        if(recentLogs.length === 0) {
          recentLogsTable.innerHTML = '<tr><td colspan="4" class="text-center">No recent logs found</td></tr>';
          return;
        }
        
        recentLogs.forEach(log => {
          const row = document.createElement('tr');
          
          let statusBadge = '';
          if(log.status === 'low') {
            statusBadge = '<span class="badge bg-success">Low</span>';
          } else if(log.status === 'medium') {
            statusBadge = '<span class="badge bg-warning">Medium</span>';
          } else {
            statusBadge = '<span class="badge bg-danger">High</span>';
          }
          
          row.innerHTML = `
            <td>${log.location}</td>
            <td>${log.date} ${log.time}</td>
            <td>${statusBadge}</td>
            <td>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteLog(${log.id})">
                <i class="bx bx-trash"></i>
              </button>
            </td>
          `;
          
          recentLogsTable.appendChild(row);
        });
      }

      // Load reports
      function loadReports() {
        const logs = JSON.parse(localStorage.getItem('trafficLogs')) || [];
        const reportTable = document.getElementById('reportTable');
        reportTable.innerHTML = '';
        
        if(logs.length === 0) {
          reportTable.innerHTML = '<tr><td colspan="6" class="text-center">No reports available</td></tr>';
          return;
        }
        
        // Sort by timestamp (newest first)
        const sortedLogs = logs.sort((a, b) => b.timestamp - a.timestamp);
        
        sortedLogs.forEach(log => {
          const row = document.createElement('tr');
          
          let statusText = '';
          if(log.status === 'low') {
            statusText = '<span class="status-indicator status-low"></span> Low';
          } else if(log.status === 'medium') {
            statusText = '<span class="status-indicator status-medium"></span> Medium';
          } else {
            statusText = '<span class="status-indicator status-high"></span> High';
          }
          
          row.innerHTML = `
            <td>${log.location}</td>
            <td>${log.date}</td>
            <td>${log.time}</td>
            <td>${statusText}</td>
            <td>${log.notes || '-'}</td>
            <td>
              <button class="btn btn-sm btn-outline-primary me-1" onclick="editLog(${log.id})">
                <i class="bx bx-edit"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteLog(${log.id})">
                <i class="bx bx-trash"></i>
              </button>
            </td>
          `;
          
          reportTable.appendChild(row);
        });
      }

      // Delete log function
      function deleteLog(logId) {
        if (confirm('Are you sure you want to delete this log?')) {
          let logs = JSON.parse(localStorage.getItem('trafficLogs')) || [];
          logs = logs.filter(log => log.id !== logId);
          localStorage.setItem('trafficLogs', JSON.stringify(logs));
          
          // Refresh displays
          loadRecentLogs();
          loadReports();
          updateDashboardStats();
          showNotification('Log deleted successfully!', 'success');
        }
      }

      // Edit log function (placeholder)
      function editLog(logId) {
        alert('Edit functionality would be implemented here. Log ID: ' + logId);
      }

      // Clear all logs
      function clearAllLogs() {
        if (confirm('Are you sure you want to delete ALL traffic logs? This action cannot be undone.')) {
          localStorage.removeItem('trafficLogs');
          loadRecentLogs();
          loadReports();
          updateDashboardStats();
          showNotification('All logs cleared successfully!', 'success');
        }
      }

      // Update dashboard statistics
      function updateDashboardStats() {
        const logs = JSON.parse(localStorage.getItem('trafficLogs')) || [];
        const today = new Date().toISOString().split('T')[0];
        const todayLogs = logs.filter(log => log.date === today);
        
        document.getElementById('totalLogs').textContent = todayLogs.length;
        
        // Update other stats based on logs
        const highTrafficLogs = todayLogs.filter(log => log.status === 'high');
        document.getElementById('activeIncidents').textContent = highTrafficLogs.length;
        
        const mediumTrafficLogs = todayLogs.filter(log => log.status === 'medium');
        document.getElementById('congestionPoints').textContent = mediumTrafficLogs.length;
      }

      // Filter reports (placeholder)
      function filterReports() {
        const filterDate = prompt('Enter date to filter (YYYY-MM-DD) or leave empty for all:');
        if (filterDate === null) return; // User cancelled
        
        const logs = JSON.parse(localStorage.getItem('trafficLogs')) || [];
        let filteredLogs = logs;
        
        if (filterDate.trim() !== '') {
          filteredLogs = logs.filter(log => log.date === filterDate.trim());
        }
        
        // Display filtered results
        const reportTable = document.getElementById('reportTable');
        reportTable.innerHTML = '';
        
        if(filteredLogs.length === 0) {
          reportTable.innerHTML = '<tr><td colspan="6" class="text-center">No reports found for the selected filter</td></tr>';
          return;
        }
        
        filteredLogs.sort((a, b) => b.timestamp - a.timestamp).forEach(log => {
          const row = document.createElement('tr');
          
          let statusText = '';
          if(log.status === 'low') {
            statusText = '<span class="status-indicator status-low"></span> Low';
          } else if(log.status === 'medium') {
            statusText = '<span class="status-indicator status-medium"></span> Medium';
          } else {
            statusText = '<span class="status-indicator status-high"></span> High';
          }
          
          row.innerHTML = `
            <td>${log.location}</td>
            <td>${log.date}</td>
            <td>${log.time}</td>
            <td>${statusText}</td>
            <td>${log.notes || '-'}</td>
            <td>
              <button class="btn btn-sm btn-outline-primary me-1" onclick="editLog(${log.id})">
                <i class="bx bx-edit"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger" onclick="deleteLog(${log.id})">
                <i class="bx bx-trash"></i>
              </button>
            </td>
          `;
          
          reportTable.appendChild(row);
        });
      }

      // Export to PDF
      function exportToPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        // Add title
        doc.setFontSize(18);
        doc.text('Traffic Monitoring Report', 14, 15);
        
        doc.setFontSize(12);
        doc.text(`Generated on: ${new Date().toLocaleString()}`, 14, 22);
        doc.text('Traffic and Transport Management System', 14, 28);
        
        // Get data from localStorage
        const logs = JSON.parse(localStorage.getItem('trafficLogs')) || [];
        
        if (logs.length === 0) {
          doc.text('No traffic logs available.', 14, 40);
        } else {
          const headers = ['Location', 'Date', 'Time', 'Status', 'Notes'];
          const rows = [];
          
          logs.sort((a, b) => b.timestamp - a.timestamp).forEach(log => {
            rows.push([
              log.location,
              log.date,
              log.time,
              log.status.charAt(0).toUpperCase() + log.status.slice(1),
              log.notes || '-'
            ]);
          });
          
          // Add table to PDF
          doc.autoTable({
            head: [headers],
            body: rows,
            startY: 35,
            styles: {
              fontSize: 10,
              cellPadding: 2
            },
            headStyles: {
              fillColor: [29, 53, 87],
              textColor: 255
            }
          });
        }
        
        // Save the PDF
        doc.save(`traffic_report_${new Date().toISOString().split('T')[0]}.pdf`);
        showNotification('Report exported successfully!', 'success');
      }

      // Print report
      function printReport() {
        window.print();
      }

      // Traffic status functions
      function refreshTrafficStatus() {
        showNotification('Traffic status refreshed!', 'info');
      }

      function filterLocations() {
        alert('Location filter functionality would be implemented here');
      }

      function toggleMapView() {
        alert('Map view toggle functionality would be implemented here');
      }

      // Notification system
      function showNotification(message, type = 'info') {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `alert alert-${type === 'success' ? 'success' : type === 'error' ? 'danger' : 'info'} alert-dismissible fade show position-fixed`;
        notification.style.cssText = 'top: 20px; right: 20px; z-index: 1050; min-width: 300px;';
        notification.innerHTML = `
          ${message}
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        
        document.body.appendChild(notification);
        
        // Auto remove after 3 seconds
        setTimeout(() => {
          if (notification.parentNode) {
            notification.parentNode.removeChild(notification);
          }
        }, 3000);
      }

      // Initialize charts
      function initializeCharts() {
        // Traffic Trend Chart
        const trendCtx = document.getElementById('trafficTrendChart').getContext('2d');
        const trendChart = new Chart(trendCtx, {
          type: 'line',
          data: {
            labels: ['12AM', '3AM', '6AM', '9AM', '12PM', '3PM', '6PM', '9PM'],
            datasets: [{
              label: 'Main Highway',
              data: [10, 8, 45, 75, 65, 80, 95, 60],
              borderColor: 'rgb(75, 192, 192)',
              backgroundColor: 'rgba(75, 192, 192, 0.1)',
              tension: 0.1,
              fill: true
            }, {
              label: 'Downtown Area',
              data: [5, 5, 60, 85, 90, 95, 100, 70],
              borderColor: 'rgb(255, 206, 86)',
              backgroundColor: 'rgba(255, 206, 86, 0.1)',
              tension: 0.1,
              fill: true
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'top',
              },
              title: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                ticks: {
                  callback: function(value) {
                    return value + '%';
                  }
                }
              }
            }
          }
        });

        // Status Distribution Chart
        const statusCtx = document.getElementById('statusDistributionChart').getContext('2d');
        const logs = JSON.parse(localStorage.getItem('trafficLogs')) || [];
        const statusCounts = {
          low: logs.filter(log => log.status === 'low').length,
          medium: logs.filter(log => log.status === 'medium').length,
          high: logs.filter(log => log.status === 'high').length
        };

        const statusChart = new Chart(statusCtx, {
          type: 'doughnut',
          data: {
            labels: ['Low Traffic', 'Medium Traffic', 'High Traffic'],
            datasets: [{
              data: [statusCounts.low, statusCounts.medium, statusCounts.high],
              backgroundColor: [
                'rgba(6, 214, 160, 0.8)',
                'rgba(255, 209, 102, 0.8)',
                'rgba(230, 57, 70, 0.8)'
              ],
              borderWidth: 2,
              borderColor: '#fff'
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                position: 'right'
              }
            }
          }
        });

        // Peak Hours Chart
        const peakCtx = document.getElementById('peakHoursChart').getContext('2d');
        const peakChart = new Chart(peakCtx, {
          type: 'bar',
          data: {
            labels: ['5-7AM', '7-9AM', '9-11AM', '11-1PM', '1-3PM', '3-5PM', '5-7PM', '7-9PM'],
            datasets: [{
              label: 'Traffic Volume',
              data: [30, 85, 60, 45, 50, 70, 90, 40],
              backgroundColor: 'rgba(29, 53, 87, 0.8)',
              borderColor: 'rgba(29, 53, 87, 1)',
              borderWidth: 1
            }]
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                display: false
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                max: 100,
                ticks: {
                  callback: function(value) {
                    return value + '%';
                  }
                }
              }
            }
          }
        });
      }

      // Profile dropdown functionality
      document.getElementById("profile-btn").addEventListener("click", function (event) {
        event.preventDefault();
        document.getElementById("dropdown-menu").classList.toggle("show");
      });

      document.addEventListener("click", function (event) {
        if (!document.getElementById("profile-btn").contains(event.target)) {
          document.getElementById("dropdown-menu").classList.remove("show");
        }
      });

      // Avatar modal functionality
      var modal = document.getElementById("avatarModal");
      var img = document.getElementById("profileAvatar");
      var modalImg = document.getElementById("modalImage");

      img.onclick = function () {
        modal.style.display = "block";
        modalImg.src = this.src;
      };

      var span = document.getElementsByClassName("close")[0];
      span.onclick = function () {
        modal.style.display = "none";
      };

      modal.onclick = function (event) {
        if (event.target === modal) {
          modal.style.display = "none";
        }
      };

      // Avatar click animation
      document.getElementById("profileAvatar").addEventListener("click", function () {
        this.style.transform = "scale(0.95)";
        setTimeout(() => {
          this.style.transform = "scale(1)";
        }, 200);
      });
    </script>
  </body>
</html>
