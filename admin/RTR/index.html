<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style1.css" />
    <link rel="stylesheet" href="css/viewprofile.css" />
    <title>LGU4 - Real-Time Road Updates</title>
    <style>
      /* Road Updates Specific Styles */
      .road-status-card {
        border-left: 4px solid;
        transition: all 0.3s;
        border-radius: 8px;
        background: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        margin-bottom: 15px;
      }
      
      .road-status-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      }
      
      .status-open {
        border-left-color: #28a745;
        background: linear-gradient(to right, rgba(40, 167, 69, 0.05), white);
      }
      
      .status-blocked {
        border-left-color: #dc3545;
        background: linear-gradient(to right, rgba(220, 53, 69, 0.05), white);
      }
      
      .status-maintenance {
        border-left-color: #ffc107;
        background: linear-gradient(to right, rgba(255, 193, 7, 0.05), white);
      }
      
      .status-indicator {
        display: inline-block;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin-right: 8px;
      }
      
      .indicator-open {
        background-color: #28a745;
      }
      
      .indicator-blocked {
        background-color: #dc3545;
      }
      
      .indicator-maintenance {
        background-color: #ffc107;
      }
      
      .road-form {
        background: white;
        border-radius: 10px;
        padding: 2rem;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        border-top: 3px solid #1d3557;
      }
      
      .updates-table {
        max-height: 500px;
        overflow-y: auto;
      }
      
      .tab-content {
        padding: 20px;
        background: white;
        border-radius: 0 0 10px 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      }
      
      .tab-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        flex-wrap: wrap;
      }
      
      .tab-button {
        padding: 10px 20px;
        background: #f8f9fa;
        border: none;
        border-radius: 5px 5px 0 0;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 14px;
      }
      
      .tab-button:hover {
        background: #e9ecef;
      }
      
      .tab-button.active {
        background: #1d3557;
        color: white;
      }
      
      .status-badge {
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: 500;
      }
      
      .badge-open {
        background-color: #d4edda;
        color: #155724;
      }
      
      .badge-blocked {
        background-color: #f8d7da;
        color: #721c24;
      }
      
      .badge-maintenance {
        background-color: #fff3cd;
        color: #856404;
      }
      
      .last-updated {
        font-size: 12px;
        color: #6c757d;
        font-style: italic;
      }
      
      .auto-refresh-indicator {
        display: inline-block;
        width: 8px;
        height: 8px;
        background-color: #28a745;
        border-radius: 50%;
        margin-right: 5px;
        animation: pulse 2s infinite;
      }
      
      @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
      }
      
      .filter-section {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
      }
      
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }
      
      .stat-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        text-align: center;
        border-top: 3px solid #1d3557;
      }
      
      .stat-number {
        font-size: 2rem;
        font-weight: bold;
        color: #1d3557;
      }
      
      .edit-buttons {
        display: none;
      }
      
      .road-status-card:hover .edit-buttons {
        display: block;
      }
    </style>
  </head>
  <body>
    <div id="avatarModal" class="modal">
      <span class="close">&times;</span>
      <img class="modal-content" id="modalImage" />
    </div>
    
    <section id="sidebar">
      <a href="#" class="brand">
        <img
          src="img/ttm.png"
          alt="Profile Photo"
          class="profile-avatar"
          id="profileAvatar"
          style="cursor: pointer; transition: transform 0.2s"
        />
        <span class="text">Traffic And Transport Management</span>
      </a>
      <ul class="side-menu top">
        <li>
          <a href="../dashboard/index.html">
            <i class="bx bxs-dashboard"></i>
            <span class="text">Dashboard</span>
          </a>
        </li>
        <span class="separator">Main</span>
        
        <li>
          <a href="../TM/index.html">
            <i class="bx bx-car"></i>
            <span class="text">Traffic Monitoring (CCTV)</span>
          </a>
        </li>
        <li class="active">
          <a href="index.html">
            <i class="bx bx-flame"></i>
            <span class="text">Real-Time Road Updates</span>
          </a>
        </li>
        <li>
          <a href="../AVR/index.html">
            <i class="bx bx-bell"></i>
            <span class="text">Accident & Violation Reports</span>
          </a>
        </li>
        <li>
          <a href="../VDR/index.html">
            <i class="bx bx-user"></i>
            <span class="text">Vehicle Routing & Diversion</span>
          </a>
        </li>
        <li>
          <a href="../TSC/index.html">
            <i class="bx bx-bar-chart-big"></i>
            <span class="text">Traffic Signal Control</span>
          </a>
        </li>
        <li>
          <a href="../PTS/index.html">
            <i class="bx bx-megaphone-alt"></i>
            <span class="text">Public Transport Sync</span>
          </a>
        </li>
        <li>
          <a href="../PATS/index.html">
            <i class="bx bx-heart-plus"></i>
            <span class="text">Permit & Ticketing System</span>
          </a>
        </li>
      </ul>
      <ul class="side-menu">
        <span class="separator">SETTINGS</span>
        <li>
          <a href="Profile.html">
            <i class="bx bxs-user-pin"></i>
            <span class="text">Profile</span>
          </a>
        </li>
        <li>
          <a href="Settings.html">
            <i class="bx bxs-cog"></i>
            <span class="text">Settings</span>
          </a>
        </li>
        <li>
          <a href="#" class="logout">
            <i class="bx bxs-log-out-circle"></i>
            <span class="text">Logout</span>
          </a>
        </li>
      </ul>
    </section>
    
    <section id="content">
      <nav>
        <a href="#" class="nav-link">Categories</a>
        <form action="#">
          <div class="form-input">
            <input type="search" placeholder="Search..." />
            <button type="submit" class="search-btn">
              <i class="bx bx-search"></i>
            </button>
          </div>
        </form>
        <a href="#" class="notification">
          <i class="bx bxs-bell"></i>
          <span class="num">9+</span>
        </a>
        <div class="profile-dropdown">
          <a href="#" class="profile" id="profile-btn">
            <img src="img/aiah.jpg" />
          </a>
          <div class="dropdown-menu" id="dropdown-menu">
            <a href="Profile.html">Profile</a>
            <a href="Settings.html">Settings</a>
          </div>
        </div>
      </nav>
      
      <main>
        <div class="head-title">
          <div class="left">
            <h1>Real-Time Road Updates</h1>
            <ul class="breadcrumb">
              <li>
                <a href="#">Dashboard</a>
              </li>
              <li><i class="bx bx-chevron-right"></i></li>
              <li>
                <a class="active" href="#">Real-Time Road Updates</a>
              </li>
            </ul>
          </div>
        </div>
        
        <div class="tab-buttons">
          <button class="tab-button active" onclick="openTab(event, 'dashboard')">
            <i class="bx bxs-dashboard"></i> Dashboard
          </button>
          <button class="tab-button" onclick="openTab(event, 'admin_post')">
            <i class="bx bx-edit"></i> Admin Post Dashboard
          </button>
          <button class="tab-button" onclick="openTab(event, 'road_status')">
            <i class="bx bx-traffic-cone"></i> Road Status Monitor
          </button>
          <button class="tab-button" onclick="openTab(event, 'notifications')">
            <i class="bx bx-bell"></i> Notification Panel
          </button>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content" style="display: block;">
          <div class="dashboard-overview">
            <h2>Road Updates Dashboard Overview</h2>
            
            <div class="stats-grid">
              <div class="stat-card">
                <div class="stat-number" id="totalRoads">0</div>
                <h5>Total Roads Monitored</h5>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="openRoads">0</div>
                <h5>Open Roads</h5>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="blockedRoads">0</div>
                <h5>Blocked Roads</h5>
              </div>
              <div class="stat-card">
                <div class="stat-number" id="maintenanceRoads">0</div>
                <h5>Under Maintenance</h5>
              </div>
            </div>
            
            <div class="row">
              <div class="col-md-6">
                <div class="road-form">
                  <h4><i class="bx bx-map-pin"></i> Recent Road Updates</h4>
                  <div id="recentUpdatesContainer">
                    <!-- Recent updates will be populated here -->
                  </div>
                </div>
              </div>
              <div class="col-md-6">
                <div class="road-form">
                  <h4><i class="bx bx-time"></i> System Status</h4>
                  <div class="d-flex align-items-center mb-3">
                    <span class="auto-refresh-indicator"></span>
                    <span>Auto-refresh: Active</span>
                  </div>
                  <p><strong>Last System Update:</strong> <span id="lastSystemUpdate"></span></p>
                  <p><strong>Total Updates Today:</strong> <span id="todayUpdates">0</span></p>
                  <p><strong>Active Alerts:</strong> <span id="activeAlerts">0</span></p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Admin Post Dashboard Tab -->
        <div id="admin_post" class="tab-content" style="display: none;">
          <div class="row">
            <div class="col-md-6">
              <div class="road-form">
                <h4><i class="bx bx-edit"></i> Create Road Update Post</h4>
                <form id="roadUpdateForm">
                  <div class="mb-3">
                    <label class="form-label">Road/Location Name</label>
                    <input type="text" class="form-control" id="roadLocation" placeholder="Enter road or location name" required>
                  </div>
                  
                  <div class="mb-3">
                    <label class="form-label">Road Status</label>
                    <select class="form-select" id="roadStatus" required>
                      <option value="">Select road status</option>
                      <option value="open">Open - Road is clear and accessible</option>
                      <option value="blocked">Blocked - Road is closed or inaccessible</option>
                      <option value="maintenance">Under Maintenance - Road work in progress</option>
                    </select>
                  </div>
                  
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label class="form-label">Date</label>
                      <input type="date" class="form-control" id="updateDate" required>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Time</label>
                      <input type="time" class="form-control" id="updateTime" required>
                    </div>
                  </div>
                  
                  <div class="mb-3">
                    <label class="form-label">Condition Details</label>
                    <textarea class="form-control" id="conditionDetails" rows="3" placeholder="Describe the current road condition or reason for status"></textarea>
                  </div>
                  
                  <div class="mb-3">
                    <label class="form-label">Estimated Duration (for maintenance/blocked)</label>
                    <input type="text" class="form-control" id="estimatedDuration" placeholder="e.g., 2 hours, 1 day, etc.">
                  </div>
                  
                  <button type="submit" class="btn btn-primary">
                    <i class="bx bx-save"></i> Post Update
                  </button>
                  <button type="reset" class="btn btn-outline-secondary ms-2">
                    <i class="bx bx-reset"></i> Reset
                  </button>
                </form>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="road-form">
                <h4><i class="bx bx-list-ul"></i> Manage Existing Posts</h4>
                <div class="updates-table">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>Location</th>
                        <th>Status</th>
                        <th>Date/Time</th>
                        <th>Actions</th>
                      </tr>
                    </thead>
                    <tbody id="managePostsTable">
                      <!-- Posts will be populated here -->
                    </tbody>
                  </table>
                </div>
                <div class="alert alert-info mt-3">
                  <i class="bx bx-info-circle"></i> Click on any post to edit or delete it.
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Road Status Monitor Tab -->
        <div id="road_status" class="tab-content" style="display: none;">
          <div class="row">
            <div class="col-md-12">
              <div class="road-form">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h4><i class="bx bx-traffic-cone"></i> Current Road Status Monitor</h4>
                  <div>
                    <button class="btn btn-sm btn-outline-primary" onclick="refreshRoadStatus()">
                      <i class="bx bx-refresh"></i> Refresh
                    </button>
                    <button class="btn btn-sm btn-outline-secondary ms-2" onclick="toggleAutoRefresh()">
                      <i class="bx bx-time"></i> <span id="autoRefreshText">Auto-Refresh: ON</span>
                    </button>
                  </div>
                </div>
                
                <div class="filter-section">
                  <div class="row">
                    <div class="col-md-4">
                      <label class="form-label">Filter by Status</label>
                      <select class="form-select" id="statusFilter" onchange="filterRoadStatus()">
                        <option value="">All Status</option>
                        <option value="open">Open</option>
                        <option value="blocked">Blocked</option>
                        <option value="maintenance">Under Maintenance</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Search Location</label>
                      <input type="text" class="form-control" id="locationSearch" placeholder="Search by location..." onkeyup="filterRoadStatus()">
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Sort by</label>
                      <select class="form-select" id="sortBy" onchange="filterRoadStatus()">
                        <option value="newest">Newest First</option>
                        <option value="oldest">Oldest First</option>
                        <option value="location">Location A-Z</option>
                        <option value="status">Status</option>
                      </select>
                    </div>
                  </div>
                </div>
                
                <div id="roadStatusContainer">
                  <!-- Road status cards will be populated here -->
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Notification Panel Tab -->
        <div id="notifications" class="tab-content" style="display: none;">
          <div class="row">
            <div class="col-md-12">
              <div class="road-form">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h4><i class="bx bx-bell"></i> Road Update Notifications</h4>
                  <div>
                    <button class="btn btn-sm btn-outline-primary" onclick="markAllAsRead()">
                      <i class="bx bx-check-double"></i> Mark All Read
                    </button>
                    <button class="btn btn-sm btn-outline-secondary ms-2" onclick="clearNotifications()">
                      <i class="bx bx-trash"></i> Clear All
                    </button>
                  </div>
                </div>
                
                <div class="filter-section">
                  <div class="row">
                    <div class="col-md-3">
                      <label class="form-label">Filter by Type</label>
                      <select class="form-select" id="notificationFilter" onchange="filterNotifications()">
                        <option value="">All Notifications</option>
                        <option value="new">New Updates</option>
                        <option value="urgent">Urgent Alerts</option>
                        <option value="maintenance">Maintenance</option>
                      </select>
                    </div>
                    <div class="col-md-3">
                      <label class="form-label">Time Range</label>
                      <select class="form-select" id="timeFilter" onchange="filterNotifications()">
                        <option value="">All Time</option>
                        <option value="today">Today</option>
                        <option value="week">This Week</option>
                        <option value="month">This Month</option>
                      </select>
                    </div>
                    <div class="col-md-4">
                      <label class="form-label">Search</label>
                      <input type="text" class="form-control" id="notificationSearch" placeholder="Search notifications..." onkeyup="filterNotifications()">
                    </div>
                    <div class="col-md-2">
                      <label class="form-label">&nbsp;</label>
                      <button class="btn btn-outline-primary w-100" onclick="refreshNotifications()">
                        <i class="bx bx-refresh"></i> Refresh
                      </button>
                    </div>
                  </div>
                </div>
                
                <div id="notificationsContainer">
                  <!-- Notifications will be populated here -->
                </div>
                
                <div class="text-center mt-3">
                  <p class="last-updated">Last updated: <span id="notificationLastUpdate"></span></p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </section>
    
    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Edit Road Update</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <form id="editForm">
              <input type="hidden" id="editId">
              <div class="mb-3">
                <label class="form-label">Road/Location Name</label>
                <input type="text" class="form-control" id="editLocation" required>
              </div>
              <div class="mb-3">
                <label class="form-label">Road Status</label>
                <select class="form-select" id="editStatus" required>
                  <option value="open">Open</option>
                  <option value="blocked">Blocked</option>
                  <option value="maintenance">Under Maintenance</option>
                </select>
              </div>
              <div class="mb-3">
                <label class="form-label">Condition Details</label>
                <textarea class="form-control" id="editDetails" rows="3"></textarea>
              </div>
              <div class="mb-3">
                <label class="form-label">Estimated Duration</label>
                <input type="text" class="form-control" id="editDuration">
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" onclick="saveEdit()">Save Changes</button>
          </div>
        </div>
      </div>
    </div>
    
    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Global variables
      let autoRefreshEnabled = true;
      let autoRefreshInterval;
      
      // Tab functionality
      function openTab(evt, tabName) {
        var i, tabcontent, tabbuttons;
        
        // Hide all tab content
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
        }
        
        // Remove active class from all buttons
        tabbuttons = document.getElementsByClassName("tab-button");
        for (i = 0; i < tabbuttons.length; i++) {
          tabbuttons[i].classList.remove("active");
        }
        
        // Show the current tab and add active class to the button
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.classList.add("active");
        
        // Load data when tabs are clicked
        if(tabName === 'dashboard') {
          loadDashboard();
        } else if(tabName === 'admin_post') {
          loadManagePosts();
        } else if(tabName === 'road_status') {
          loadRoadStatus();
        } else if(tabName === 'notifications') {
          loadNotifications();
        }
      }
      
      // Road Update Form Handling
      document.getElementById('roadUpdateForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form values
        const location = document.getElementById('roadLocation').value;
        const status = document.getElementById('roadStatus').value;
        const date = document.getElementById('updateDate').value;
        const time = document.getElementById('updateTime').value;
        const details = document.getElementById('conditionDetails').value;
        const duration = document.getElementById('estimatedDuration').value;
        
        // Create update object
        const updateEntry = {
          id: Date.now(),
          location,
          status,
          date,
          time,
          details,
          duration,
          timestamp: new Date().getTime(),
          isRead: false
        };
        
        // Save to localStorage
        saveRoadUpdate(updateEntry);
        
        // Reset form
        this.reset();
        
        // Show success message
        alert('Road update posted successfully!');
        
        // Refresh displays
        loadManagePosts();
        loadDashboard();
        loadRoadStatus();
        loadNotifications();
      });
      
      // Save road update to localStorage
      function saveRoadUpdate(updateEntry) {
        let updates = JSON.parse(localStorage.getItem('roadUpdates')) || [];
        updates.push(updateEntry);
        localStorage.setItem('roadUpdates', JSON.stringify(updates));
      }
      
      // Load dashboard data
      function loadDashboard() {
        const updates = JSON.parse(localStorage.getItem('roadUpdates')) || [];
        
        // Update statistics
        const totalRoads = updates.length;
        const openRoads = updates.filter(u => u.status === 'open').length;
        const blockedRoads = updates.filter(u => u.status === 'blocked').length;
        const maintenanceRoads = updates.filter(u => u.status === 'maintenance').length;
        
        document.getElementById('totalRoads').textContent = totalRoads;
        document.getElementById('openRoads').textContent = openRoads;
        document.getElementById('blockedRoads').textContent = blockedRoads;
        document.getElementById('maintenanceRoads').textContent = maintenanceRoads;
        
        // Load recent updates
        const recentUpdates = updates.sort((a, b) => b.timestamp - a.timestamp).slice(0, 5);
        const container = document.getElementById('recentUpdatesContainer');
        container.innerHTML = '';
        
        if(recentUpdates.length === 0) {
          container.innerHTML = '<p class="text-muted">No recent updates available</p>';
          return;
        }
        
        recentUpdates.forEach(update => {
          const statusClass = `status-${update.status}`;
          const indicatorClass = `indicator-${update.status}`;
          
          const updateCard = document.createElement('div');
          updateCard.className = `road-status-card ${statusClass} p-3 mb-2`;
          updateCard.innerHTML = `
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h6 class="mb-1">${update.location}</h6>
                <p class="mb-0 small">${update.details || 'No additional details'}</p>
              </div>
              <div class="text-end">
                <span class="status-indicator ${indicatorClass}"></span>
                <small class="text-capitalize">${update.status}</small>
                <div class="last-updated">${update.date} ${update.time}</div>
              </div>
            </div>
          `;
          container.appendChild(updateCard);
        });
        
        // Update system status
        document.getElementById('lastSystemUpdate').textContent = new Date().toLocaleString();
        document.getElementById('todayUpdates').textContent = getTodayUpdatesCount();
        document.getElementById('activeAlerts').textContent = getActiveAlertsCount();
      }
      
      // Load manage posts
      function loadManagePosts() {
        const updates = JSON.parse(localStorage.getItem('roadUpdates')) || [];
        const table = document.getElementById('managePostsTable');
        table.innerHTML = '';
        
        if(updates.length === 0) {
          table.innerHTML = '<tr><td colspan="4" class="text-center">No posts available</td></tr>';
          return;
        }
        
        const sortedUpdates = updates.sort((a, b) => b.timestamp - a.timestamp);
        
        sortedUpdates.forEach(update => {
          const row = document.createElement('tr');
          
          let statusBadge = '';
          if(update.status === 'open') {
            statusBadge = '<span class="status-badge badge-open">Open</span>';
          } else if(update.status === 'blocked') {
            statusBadge = '<span class="status-badge badge-blocked">Blocked</span>';
          } else {
            statusBadge = '<span class="status-badge badge-maintenance">Maintenance</span>';
          }
          
          row.innerHTML = `
            <td>${update.location}</td>
            <td>${statusBadge}</td>
            <td>${update.date} ${update.time}</td>
            <td>
              <button class="btn btn-sm btn-outline-primary" onclick="editPost(${update.id})">
                <i class="bx bx-edit"></i>
              </button>
              <button class="btn btn-sm btn-outline-danger ms-1" onclick="deletePost(${update.id})">
                <i class="bx bx-trash"></i>
              </button>
            </td>
          `;
          
          table.appendChild(row);
        });
      }
      
      // Load road status
      function loadRoadStatus() {
        filterRoadStatus();
      }
      
      // Filter road status
      function filterRoadStatus() {
        const updates = JSON.parse(localStorage.getItem('roadUpdates')) || [];
        const statusFilter = document.getElementById('statusFilter').value;
        const locationSearch = document.getElementById('locationSearch').value.toLowerCase();
        const sortBy = document.getElementById('sortBy').value;
        
        let filteredUpdates = updates;
        
        // Apply status filter
        if(statusFilter) {
          filteredUpdates = filteredUpdates.filter(u => u.status === statusFilter);
        }
        
        // Apply location search
        if(locationSearch) {
          filteredUpdates = filteredUpdates.filter(u => 
            u.location.toLowerCase().includes(locationSearch)
          );
        }
        
        // Apply sorting
        switch(sortBy) {
          case 'newest':
            filteredUpdates.sort((a, b) => b.timestamp - a.timestamp);
            break;
          case 'oldest':
            filteredUpdates.sort((a, b) => a.timestamp - b.timestamp);
            break;
          case 'location':
            filteredUpdates.sort((a, b) => a.location.localeCompare(b.location));
            break;
          case 'status':
            filteredUpdates.sort((a, b) => a.status.localeCompare(b.status));
            break;
        }
        
        const container = document.getElementById('roadStatusContainer');
        container.innerHTML = '';
        
        if(filteredUpdates.length === 0) {
          container.innerHTML = '<div class="alert alert-info">No road updates match your filters</div>';
          return;
        }
        
        filteredUpdates.forEach(update => {
          const statusClass = `status-${update.status}`;
          const indicatorClass = `indicator-${update.status}`;
          
          const updateCard = document.createElement('div');
          updateCard.className = `road-status-card ${statusClass} p-3 mb-3`;
          updateCard.innerHTML = `
            <div class="d-flex justify-content-between align-items-start">
              <div class="flex-grow-1">
                <h5 class="mb-2">
                  <span class="status-indicator ${indicatorClass}"></span>
                  ${update.location}
                </h5>
                <p class="mb-2">${update.details || 'No additional details provided'}</p>
                ${update.duration ? `<p class="mb-2"><strong>Duration:</strong> ${update.duration}</p>` : ''}
                <div class="last-updated">
                  Last updated: ${update.date} at ${update.time}
                </div>
              </div>
              <div class="edit-buttons">
                <button class="btn btn-sm btn-outline-primary me-1" onclick="editPost(${update.id})">
                  <i class="bx bx-edit"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger" onclick="deletePost(${update.id})">
                  <i class="bx bx-trash"></i>
                </button>
              </div>
            </div>
          `;
          container.appendChild(updateCard);
        });
      }
      
      // Load notifications
      function loadNotifications() {
        filterNotifications();
      }
      
      // Filter notifications
      function filterNotifications() {
        const updates = JSON.parse(localStorage.getItem('roadUpdates')) || [];
        const notificationFilter = document.getElementById('notificationFilter').value;
        const timeFilter = document.getElementById('timeFilter').value;
        const searchTerm = document.getElementById('notificationSearch').value.toLowerCase();
        
        let filteredUpdates = updates;
        
        // Apply notification type filter
        if(notificationFilter === 'urgent') {
          filteredUpdates = filteredUpdates.filter(u => u.status === 'blocked');
        } else if(notificationFilter === 'maintenance') {
          filteredUpdates = filteredUpdates.filter(u => u.status === 'maintenance');
        } else if(notificationFilter === 'new') {
          filteredUpdates = filteredUpdates.filter(u => !u.isRead);
        }
        
        // Apply time filter
        const now = new Date();
        if(timeFilter === 'today') {
          const today = now.toISOString().split('T')[0];
          filteredUpdates = filteredUpdates.filter(u => u.date === today);
        } else if(timeFilter === 'week') {
          const weekAgo = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
          filteredUpdates = filteredUpdates.filter(u => new Date(u.date) >= weekAgo);
        } else if(timeFilter === 'month') {
          const monthAgo = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);
          filteredUpdates = filteredUpdates.filter(u => new Date(u.date) >= monthAgo);
        }
        
        // Apply search filter
        if(searchTerm) {
          filteredUpdates = filteredUpdates.filter(u => 
            u.location.toLowerCase().includes(searchTerm) ||
            (u.details && u.details.toLowerCase().includes(searchTerm))
          );
        }
        
        // Sort by newest first
        filteredUpdates.sort((a, b) => b.timestamp - a.timestamp);
        
        const container = document.getElementById('notificationsContainer');
        container.innerHTML = '';
        
        if(filteredUpdates.length === 0) {
          container.innerHTML = '<div class="alert alert-info">No notifications match your filters</div>';
          return;
        }
        
        filteredUpdates.forEach(update => {
          const isUrgent = update.status === 'blocked';
          const isNew = !update.isRead;
          
          const notificationCard = document.createElement('div');
          notificationCard.className = `alert ${isUrgent ? 'alert-danger' : isNew ? 'alert-warning' : 'alert-info'} d-flex justify-content-between align-items-start`;
          notificationCard.innerHTML = `
            <div class="flex-grow-1">
              <div class="d-flex align-items-center mb-2">
                <i class="bx ${isUrgent ? 'bx-error' : isNew ? 'bx-bell' : 'bx-info-circle'} me-2"></i>
                <strong>${update.location}</strong>
                ${isNew ? '<span class="badge bg-primary ms-2">New</span>' : ''}
                ${isUrgent ? '<span class="badge bg-danger ms-2">Urgent</span>' : ''}
              </div>
              <p class="mb-1">${update.details || 'Road status updated'}</p>
              <small class="text-muted">
                Status: <span class="text-capitalize">${update.status}</span> | 
                ${update.date} at ${update.time}
              </small>
            </div>
            <button class="btn btn-sm btn-outline-secondary" onclick="markAsRead(${update.id})">
              <i class="bx bx-check"></i>
            </button>
          `;
          container.appendChild(notificationCard);
        });
        
        // Update last refresh time
        document.getElementById('notificationLastUpdate').textContent = new Date().toLocaleString();
      }
      
      // Edit post function
      function editPost(id) {
        const updates = JSON.parse(localStorage.getItem('roadUpdates')) || [];
        const update = updates.find(u => u.id === id);
        
        if(update) {
          document.getElementById('editId').value = update.id;
          document.getElementById('editLocation').value = update.location;
          document.getElementById('editStatus').value = update.status;
          document.getElementById('editDetails').value = update.details || '';
          document.getElementById('editDuration').value = update.duration || '';
          
          const modal = new bootstrap.Modal(document.getElementById('editModal'));
          modal.show();
        }
      }
      
      // Save edit function
      function saveEdit() {
        const id = parseInt(document.getElementById('editId').value);
        const location = document.getElementById('editLocation').value;
        const status = document.getElementById('editStatus').value;
        const details = document.getElementById('editDetails').value;
        const duration = document.getElementById('editDuration').value;
        
        let updates = JSON.parse(localStorage.getItem('roadUpdates')) || [];
        const updateIndex = updates.findIndex(u => u.id === id);
        
        if(updateIndex !== -1) {
          updates[updateIndex].location = location;
          updates[updateIndex].status = status;
          updates[updateIndex].details = details;
          updates[updateIndex].duration = duration;
          updates[updateIndex].timestamp = new Date().getTime();
          
          localStorage.setItem('roadUpdates', JSON.stringify(updates));
          
          // Close modal
          const modal = bootstrap.Modal.getInstance(document.getElementById('editModal'));
          modal.hide();
          
          // Refresh displays
          loadManagePosts();
          loadDashboard();
          loadRoadStatus();
          loadNotifications();
          
          alert('Road update saved successfully!');
        }
      }
      
      // Delete post function
      function deletePost(id) {
        if(confirm('Are you sure you want to delete this road update?')) {
          let updates = JSON.parse(localStorage.getItem('roadUpdates')) || [];
          updates = updates.filter(u => u.id !== id);
          localStorage.setItem('roadUpdates', JSON.stringify(updates));
          
          // Refresh displays
          loadManagePosts();
          loadDashboard();
          loadRoadStatus();
          loadNotifications();
          
          alert('Road update deleted successfully!');
        }
      }
      
      // Utility functions
      function getTodayUpdatesCount() {
        const updates = JSON.parse(localStorage.getItem('roadUpdates')) || [];
        const today = new Date().toISOString().split('T')[0];
        return updates.filter(u => u.date === today).length;
      }
      
      function getActiveAlertsCount() {
        const updates = JSON.parse(localStorage.getItem('roadUpdates')) || [];
        return updates.filter(u => u.status === 'blocked' || u.status === 'maintenance').length;
      }
      
      function refreshRoadStatus() {
        loadRoadStatus();
        alert('Road status refreshed!');
      }
      
      function toggleAutoRefresh() {
        autoRefreshEnabled = !autoRefreshEnabled;
        const text = document.getElementById('autoRefreshText');
        text.textContent = `Auto-Refresh: ${autoRefreshEnabled ? 'ON' : 'OFF'}`;
        
        if(autoRefreshEnabled) {
          startAutoRefresh();
        } else {
          stopAutoRefresh();
        }
      }
      
      function startAutoRefresh() {
        autoRefreshInterval = setInterval(() => {
          loadRoadStatus();
          loadNotifications();
        }, 30000); // Refresh every 30 seconds
      }
      
      function stopAutoRefresh() {
        if(autoRefreshInterval) {
          clearInterval(autoRefreshInterval);
        }
      }
      
      function refreshNotifications() {
        loadNotifications();
      }
      
      function markAsRead(id) {
        let updates = JSON.parse(localStorage.getItem('roadUpdates')) || [];
        const updateIndex = updates.findIndex(u => u.id === id);
        
        if(updateIndex !== -1) {
          updates[updateIndex].isRead = true;
          localStorage.setItem('roadUpdates', JSON.stringify(updates));
          loadNotifications();
        }
      }
      
      function markAllAsRead() {
        let updates = JSON.parse(localStorage.getItem('roadUpdates')) || [];
        updates.forEach(u => u.isRead = true);
        localStorage.setItem('roadUpdates', JSON.stringify(updates));
        loadNotifications();
        alert('All notifications marked as read!');
      }
      
      function clearNotifications() {
        if(confirm('Are you sure you want to clear all notifications?')) {
          localStorage.removeItem('roadUpdates');
          loadNotifications();
          loadDashboard();
          loadManagePosts();
          loadRoadStatus();
          alert('All notifications cleared!');
        }
      }
      
      // Initialize page
      document.addEventListener('DOMContentLoaded', function() {
        // Set current date and time
        const now = new Date();
        document.getElementById('updateDate').value = now.toISOString().split('T')[0];
        document.getElementById('updateTime').value = now.toTimeString().slice(0, 5);
        
        // Load initial data
        loadDashboard();
        
        // Start auto-refresh
        startAutoRefresh();
      });
      
      // Profile dropdown functionality
      document.getElementById("profile-btn").addEventListener("click", function (event) {
        event.preventDefault();
        document.getElementById("dropdown-menu").classList.toggle("show");
      });
      
      document.addEventListener("click", function (event) {
        if (!document.getElementById("profile-btn").contains(event.target)) {
          document.getElementById("dropdown-menu").classList.remove("show");
        }
      });
      
      // Avatar modal functionality
      var modal = document.getElementById("avatarModal");
      var img = document.getElementById("profileAvatar");
      var modalImg = document.getElementById("modalImage");
      
      img.onclick = function () {
        modal.style.display = "block";
        modalImg.src = this.src;
      };
      
      var span = document.getElementsByClassName("close")[0];
      span.onclick = function () {
        modal.style.display = "none";
      };
      
      modal.onclick = function (event) {
        if (event.target === modal) {
          modal.style.display = "none";
        }
      };
      
      // Avatar click animation
      document.getElementById("profileAvatar").addEventListener("click", function () {
        this.style.transform = "scale(0.95)";
        setTimeout(() => {
          this.style.transform = "scale(1)";
        }, 200);
      });
    </script>
  </body>
</html>
