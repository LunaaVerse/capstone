<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="css/style1.css" />
    <link rel="stylesheet" href="css/viewprofile.css" />
    <title>LGU4 - Permit & Ticketing System</title>
    <style>
      /* Permit & Ticketing System Specific Styles */
      .permit-card {
        border-left: 4px solid #1d3557;
        transition: all 0.3s;
        border-radius: 8px;
        background: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        margin-bottom: 15px;
      }
      
      .permit-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      }
      
      .ticket-card {
        border-left: 4px solid;
        transition: all 0.3s;
        border-radius: 8px;
        background: white;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        margin-bottom: 15px;
      }
      
      .ticket-unpaid {
        border-left-color: #e63946;
        background: linear-gradient(to right, rgba(230, 57, 70, 0.05), white);
      }
      
      .ticket-paid {
        border-left-color: #06d6a0;
        background: linear-gradient(to right, rgba(6, 214, 160, 0.05), white);
      }
      
      .status-badge {
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
      }
      
      .status-pending {
        background-color: #ffd166;
        color: #8a6d00;
      }
      
      .status-approved {
        background-color: #06d6a0;
        color: #005a40;
      }
      
      .status-rejected {
        background-color: #e63946;
        color: white;
      }
      
      .permit-form {
        background: white;
        border-radius: 10px;
        padding: 2rem;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        border-top: 3px solid #1d3557;
      }
      
      .report-table {
        max-height: 500px;
        overflow-y: auto;
      }
      
      .tab-content {
        padding: 20px;
        background: white;
        border-radius: 0 0 10px 10px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.05);
      }
      
      .tab-buttons {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
      }
      
      .tab-button {
        padding: 10px 20px;
        background: #f8f9fa;
        border: none;
        border-radius: 5px 5px 0 0;
        cursor: pointer;
        transition: all 0.3s;
      }
      
      .tab-button:hover {
        background: #e9ecef;
      }
      
      .tab-button.active {
        background: #1d3557;
        color: white;
      }
      
      .permit-id {
        font-weight: bold;
        color: #1d3557;
      }
    </style>
  </head>
  <body>
    <div id="avatarModal" class="modal">
      <span class="close">&times;</span>
      <img class="modal-content" id="modalImage" />
    </div>
    <section id="sidebar">
      <a href="#" class="brand">
        <img
          src="img/ttm.png"
          alt="Profile Photo"
          class="profile-avatar"
          id="profileAvatar"
          style="cursor: pointer; transition: transform 0.2s"
        />
        <span class="text">Traffic And Transport Management</span>
      </a>
      <ul class="side-menu top">
        <li>
          <a href="index.html">
            <i class="bx bxs-dashboard"></i>
            <span class="text">Dashboard</span>
          </a>
        </li>
        <span class="separator">Main</span>
      
        <li>
          <a href="../TM/index.html">
            <i class="bx bx-car"></i>
            <span class="text">Traffic Monitoring (CCTV) </span>
          </a>
        </li>
        <li>
          <a href="../RTR/index.html">
            <i class="bx bx-flame"></i>
            <span class="text">Real-Time Road Updates</span>
          </a>
        </li>
        <li>
          <a href="../AVR/index.html">
            <i class="bx bx-bell"></i>
            <span class="text"> Accident & Violation Reports </span>
          </a>
        </li>
        <li>
          <a href="../VRD/index.html">
            <i class="bx bx-user"></i>
            <span class="text">Vehicle Routing & Diversion</span>
          </a>
        </li>
        <li>
          <a href="../TSC/index.html">
            <i class="bx bx-bar-chart-big"></i>
            <span class="text"> Traffic Signal Control</span>
          </a>
        </li>
        <li>
          <a href="../PTS/index.html">
            <i class="bx bx-megaphone-alt"></i>
            <span class="text">Public Transport Sync </span>
          </a>
        </li>
        <li class="active">
          <a href="#">
            <i class="bx bx-heart-plus"></i>
            <span class="text">Permit & Ticketing System</span>
          </a>
        </li>
        
      </ul>
      <ul class="side-menu">
        <span class="separator">SETTINGS</span>
        <li>
          <a href="Profile.html">
            <i class="bx bxs-user-pin"></i>
            <span class="text">Profile</span>
          </a>
        </li>
        <li>
          <a href="Settings.html">
            <i class="bx bxs-cog"></i>
            <span class="text">Settings</span>
          </a>
        </li>
        <li>
          <a href="#" class="logout">
            <i class="bx bxs-log-out-circle"></i>
            <span class="text">Logout</span>
          </a>
        </li>
      </ul>
    </section>
    <section id="content">
      <nav>
        <a href="#" class="nav-link">Categories</a>
        <form action="#">
          <div class="form-input">
            <input type="search" placeholder="Search..." />
            <button type="submit" class="search-btn">
              <i class="bx bx-search"></i>
            </button>
          </div>
        </form>
        <a href="#" class="notification">
          <i class="bx bxs-bell"></i>
          <span class="num">9+</span>
        </a>
        <div class="profile-dropdown">
          <a href="#" class="profile" id="profile-btn">
            <img src="img/aiah.jpg" />
          </a>
          <div class="dropdown-menu" id="dropdown-menu">
            <a href="Profile.html">Profile</a>
            <a href="Settings.html">Settings</a>
          </div>
        </div>
      </nav>
      <main>
        <div class="head-title">
          <div class="left">
            <h1>Permit & Ticketing System</h1>
            <ul class="breadcrumb">
              <li>
                <a href="#">Dashboard</a>
              </li>
              <li><i class="bx bx-chevron-right"></i></li>
              <li>
                <a class="active" href="#">Permit & Ticketing System</a>
              </li>
            </ul>
          </div>
        </div>
        
        <div class="tab-buttons">
          <button class="tab-button active" onclick="openTab(event, 'permit_request')">
            <i class="bx bx-file"></i> Permit Request
          </button>
          <button class="tab-button" onclick="openTab(event, 'ticket_log')">
            <i class="bx bx-edit"></i> Ticket Log
          </button>
          <button class="tab-button" onclick="openTab(event, 'user_status')">
            <i class="bx bx-user"></i> My Status
          </button>
        </div>
        
        <!-- Permit Request Tab -->
        <div id="permit_request" class="tab-content" style="display: block;">
          <div class="row">
            <div class="col-md-6">
              <div class="permit-form">
                <h4><i class="bx bx-file"></i> Permit Request Form</h4>
                <form id="permitRequestForm">
                  <div class="mb-3">
                    <label class="form-label">Full Name</label>
                    <input type="text" class="form-control" id="permitName" placeholder="Enter your full name" required>
                  </div>
                  
                  <div class="mb-3">
                    <label class="form-label">Event/Purpose</label>
                    <input type="text" class="form-control" id="permitEvent" placeholder="Describe the event or purpose" required>
                  </div>
                  
                  <div class="mb-3">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-control" id="permitLocation" placeholder="Enter exact location" required>
                  </div>
                  
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label class="form-label">Start Date</label>
                      <input type="date" class="form-control" id="permitStartDate" required>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">End Date</label>
                      <input type="date" class="form-control" id="permitEndDate" required>
                    </div>
                  </div>
                  
                  <div class="mb-3">
                    <label class="form-label">Additional Information</label>
                    <textarea class="form-control" id="permitNotes" rows="3" placeholder="Any additional details about your request"></textarea>
                  </div>
                  
                  <button type="submit" class="btn btn-primary">
                    <i class="bx bx-send"></i> Submit Request
                  </button>
                  <button type="reset" class="btn btn-outline-secondary ms-2">
                    <i class="bx bx-reset"></i> Reset
                  </button>
                </form>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="permit-form">
                <h4><i class="bx bx-info-circle"></i> Permit Information</h4>
                <div class="alert alert-info">
                  <p><strong>Permit Processing Information:</strong></p>
                  <ul>
                    <li>Permits are typically processed within 3-5 business days</li>
                    <li>You will receive notification via email when your permit is approved</li>
                    <li>Approved permits must be printed and available at the event location</li>
                  </ul>
                </div>
                
                <div class="alert alert-warning">
                  <p><strong>Important Notes:</strong></p>
                  <ul>
                    <li>Falsifying information may result in permit revocation</li>
                    <li>Permits do not guarantee exclusive use of public spaces</li>
                    <li>Additional permits may be required for certain activities</li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Ticket Log Tab -->
        <div id="ticket_log" class="tab-content" style="display: none;">
          <div class="row">
            <div class="col-md-6">
              <div class="permit-form">
                <h4><i class="bx bx-edit"></i> Issue Violation Ticket</h4>
                <form id="ticketForm">
                  <div class="mb-3">
                    <label class="form-label">Violator Name</label>
                    <input type="text" class="form-control" id="violatorName" placeholder="Enter violator's name" required>
                  </div>
                  
                  <div class="mb-3">
                    <label class="form-label">Violation Type</label>
                    <select class="form-select" id="violationType" required>
                      <option value="">Select violation type</option>
                      <option value="Illegal Parking">Illegal Parking</option>
                      <option value="No Permit">No Permit</option>
                      <option value="Obstruction">Obstruction</option>
                      <option value="Other">Other</option>
                    </select>
                  </div>
                  
                  <div class="mb-3">
                    <label class="form-label">Location</label>
                    <input type="text" class="form-control" id="violationLocation" placeholder="Enter violation location" required>
                  </div>
                  
                  <div class="row mb-3">
                    <div class="col-md-6">
                      <label class="form-label">Date</label>
                      <input type="date" class="form-control" id="violationDate" required>
                    </div>
                    <div class="col-md-6">
                      <label class="form-label">Time</label>
                      <input type="time" class="form-control" id="violationTime" required>
                    </div>
                  </div>
                  
                  <div class="mb-3">
                    <label class="form-label">Fine Amount</label>
                    <input type="number" class="form-control" id="violationFine" placeholder="Enter fine amount" required>
                  </div>
                  
                  <div class="mb-3">
                    <label class="form-label">Additional Notes</label>
                    <textarea class="form-control" id="violationNotes" rows="3" placeholder="Enter any additional details"></textarea>
                  </div>
                  
                  <button type="submit" class="btn btn-primary">
                    <i class="bx bx-save"></i> Save Ticket
                  </button>
                  <button type="reset" class="btn btn-outline-secondary ms-2">
                    <i class="bx bx-reset"></i> Reset
                  </button>
                </form>
              </div>
            </div>
            
            <div class="col-md-6">
              <div class="permit-form">
                <h4><i class="bx bx-list-ul"></i> Recent Tickets</h4>
                <div class="report-table">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>Violator</th>
                        <th>Violation</th>
                        <th>Amount</th>
                        <th>Status</th>
                      </tr>
                    </thead>
                    <tbody id="recentTicketsTable">
                      <!-- Tickets will be populated here -->
                    </tbody>
                  </table>
                </div>
                <div class="alert alert-info mt-3">
                  <i class="bx bx-info-circle"></i> Tickets are saved to your browser's local storage.
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- User Status Tab -->
        <div id="user_status" class="tab-content" style="display: none;">
          <div class="row">
            <div class="col-md-12">
              <div class="permit-form">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h4><i class="bx bx-file"></i> My Permit Requests</h4>
                  <div>
                    <button class="btn btn-sm btn-outline-secondary" onclick="filterPermits()">
                      <i class="bx bx-filter"></i> Filter
                    </button>
                    <button class="btn btn-sm btn-outline-primary ms-2" onclick="searchPermits()">
                      <i class="bx bx-search"></i> Search
                    </button>
                  </div>
                </div>
                
                <div class="report-table">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>Permit ID</th>
                        <th>Event/Purpose</th>
                        <th>Location</th>
                        <th>Date</th>
                        <th>Status</th>
                      </tr>
                    </thead>
                    <tbody id="userPermitsTable">
                      <!-- User permits will be populated here -->
                    </tbody>
                  </table>
                </div>
                
                <div class="alert alert-info mt-3">
                  <i class="bx bx-info-circle"></i> Showing all your permit requests.
                </div>
              </div>
            </div>
          </div>
          
          <div class="row mt-4">
            <div class="col-md-12">
              <div class="permit-form">
                <div class="d-flex justify-content-between align-items-center mb-3">
                  <h4><i class="bx bx-list-check"></i> My Tickets</h4>
                  <div>
                    <button class="btn btn-sm btn-outline-secondary" onclick="filterTickets()">
                      <i class="bx bx-filter"></i> Filter
                    </button>
                    <button class="btn btn-sm btn-outline-primary ms-2" onclick="searchTickets()">
                      <i class="bx bx-search"></i> Search
                    </button>
                  </div>
                </div>
                
                <div class="report-table">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>Ticket ID</th>
                        <th>Violation</th>
                        <th>Date</th>
                        <th>Amount</th>
                        <th>Status</th>
                      </tr>
                    </thead>
                    <tbody id="userTicketsTable">
                      <!-- User tickets will be populated here -->
                    </tbody>
                  </table>
                </div>
                
                <div class="alert alert-info mt-3">
                  <i class="bx bx-info-circle"></i> Showing all your ticket records.
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
    </section>
    
    <script src="script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

    <script>
      // Tab functionality
      function openTab(evt, tabName) {
        var i, tabcontent, tabbuttons;
        
        // Hide all tab content
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
          tabcontent[i].style.display = "none";
        }
        
        // Remove active class from all buttons
        tabbuttons = document.getElementsByClassName("tab-button");
        for (i = 0; i < tabbuttons.length; i++) {
          tabbuttons[i].classList.remove("active");
        }
        
        // Show the current tab and add active class to the button
        document.getElementById(tabName).style.display = "block";
        evt.currentTarget.classList.add("active");
        
        // Load data when tabs are clicked
        if(tabName === 'ticket_log') {
          loadRecentTickets();
        } else if(tabName === 'user_status') {
          loadUserPermits();
          loadUserTickets();
        }
      }
      
      // Permit Request Form Handling
      document.getElementById('permitRequestForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form values
        const name = document.getElementById('permitName').value;
        const event = document.getElementById('permitEvent').value;
        const location = document.getElementById('permitLocation').value;
        const startDate = document.getElementById('permitStartDate').value;
        const endDate = document.getElementById('permitEndDate').value;
        const notes = document.getElementById('permitNotes').value;
        
        // Generate permit ID
        const permitId = 'PER-' + Math.floor(100000 + Math.random() * 900000);
        
        // Create permit object
        const permitEntry = {
          id: permitId,
          name,
          event,
          location,
          startDate,
          endDate,
          notes,
          status: 'Pending',
          timestamp: new Date().getTime()
        };
        
        // Save to localStorage
        savePermit(permitEntry);
        
        // Reset form
        this.reset();
        
        // Show success message with permit ID
        alert(`Permit request submitted successfully!\nYour Permit ID: ${permitId}`);
        
        // Refresh user permits if on that tab
        if(document.getElementById('user_status').style.display === 'block') {
          loadUserPermits();
        }
      });
      
      // Save permit to localStorage
      function savePermit(permitEntry) {
        let permits = JSON.parse(localStorage.getItem('userPermits')) || [];
        permits.push(permitEntry);
        localStorage.setItem('userPermits', JSON.stringify(permits));
      }
      
      // Ticket Form Handling
      document.getElementById('ticketForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form values
        const name = document.getElementById('violatorName').value;
        const type = document.getElementById('violationType').value;
        const location = document.getElementById('violationLocation').value;
        const date = document.getElementById('violationDate').value;
        const time = document.getElementById('violationTime').value;
        const fine = document.getElementById('violationFine').value;
        const notes = document.getElementById('violationNotes').value;
        
        // Generate ticket ID
        const ticketId = 'TKT-' + Math.floor(100000 + Math.random() * 900000);
        
        // Create ticket object
        const ticketEntry = {
          id: ticketId,
          name,
          type,
          location,
          date,
          time,
          fine,
          notes,
          status: 'Unpaid',
          timestamp: new Date().getTime()
        };
        
        // Save to localStorage
        saveTicket(ticketEntry);
        
        // Reset form
        this.reset();
        
        // Show success message
        alert(`Ticket ${ticketId} issued successfully!`);
        
        // Refresh recent tickets
        loadRecentTickets();
      });
      
      // Save ticket to localStorage
      function saveTicket(ticketEntry) {
        let tickets = JSON.parse(localStorage.getItem('tickets')) || [];
        tickets.push(ticketEntry);
        localStorage.setItem('tickets', JSON.stringify(tickets));
      }
      
      // Load recent tickets
      function loadRecentTickets() {
        const tickets = JSON.parse(localStorage.getItem('tickets')) || [];
        const recentTicketsTable = document.getElementById('recentTicketsTable');
        recentTicketsTable.innerHTML = '';
        
        // Sort by timestamp (newest first) and get last 5
        const recentTickets = tickets.sort((a, b) => b.timestamp - a.timestamp).slice(0, 5);
        
        if(recentTickets.length === 0) {
          recentTicketsTable.innerHTML = '<tr><td colspan="4" class="text-center">No recent tickets found</td></tr>';
          return;
        }
        
        recentTickets.forEach(ticket => {
          const row = document.createElement('tr');
          
          let statusBadge = '';
          if(ticket.status === 'Paid') {
            statusBadge = '<span class="badge bg-success">Paid</span>';
          } else {
            statusBadge = '<span class="badge bg-danger">Unpaid</span>';
          }
          
          row.innerHTML = `
            <td>${ticket.name}</td>
            <td>${ticket.type}</td>
            <td>₱${ticket.fine}</td>
            <td>${statusBadge}</td>
          `;
          
          recentTicketsTable.appendChild(row);
        });
      }
      
      // Load user permits
      function loadUserPermits() {
        const permits = JSON.parse(localStorage.getItem('userPermits')) || [];
        const userPermitsTable = document.getElementById('userPermitsTable');
        userPermitsTable.innerHTML = '';
        
        if(permits.length === 0) {
          userPermitsTable.innerHTML = '<tr><td colspan="5" class="text-center">No permit requests found</td></tr>';
          return;
        }
        
        // Sort by timestamp (newest first)
        const sortedPermits = permits.sort((a, b) => b.timestamp - a.timestamp);
        
        sortedPermits.forEach(permit => {
          const row = document.createElement('tr');
          
          let statusBadge = '';
          if(permit.status === 'Approved') {
            statusBadge = '<span class="status-badge status-approved">Approved</span>';
          } else if(permit.status === 'Rejected') {
            statusBadge = '<span class="status-badge status-rejected">Rejected</span>';
          } else {
            statusBadge = '<span class="status-badge status-pending">Pending</span>';
          }
          
          row.innerHTML = `
            <td><span class="permit-id">${permit.id}</span></td>
            <td>${permit.event}</td>
            <td>${permit.location}</td>
            <td>${permit.startDate} to ${permit.endDate}</td>
            <td>${statusBadge}</td>
          `;
          
          userPermitsTable.appendChild(row);
        });
      }
      
      // Load user tickets
      function loadUserTickets() {
        const tickets = JSON.parse(localStorage.getItem('tickets')) || [];
        const userTicketsTable = document.getElementById('userTicketsTable');
        userTicketsTable.innerHTML = '';
        
        if(tickets.length === 0) {
          userTicketsTable.innerHTML = '<tr><td colspan="5" class="text-center">No ticket records found</td></tr>';
          return;
        }
        
        // Sort by timestamp (newest first)
        const sortedTickets = tickets.sort((a, b) => b.timestamp - a.timestamp);
        
        sortedTickets.forEach(ticket => {
          const row = document.createElement('tr');
          
          let statusBadge = '';
          if(ticket.status === 'Paid') {
            statusBadge = '<span class="badge bg-success">Paid</span>';
          } else {
            statusBadge = '<span class="badge bg-danger">Unpaid</span>';
          }
          
          row.innerHTML = `
            <td><span class="permit-id">${ticket.id}</span></td>
            <td>${ticket.type}</td>
            <td>${ticket.date} ${ticket.time}</td>
            <td>₱${ticket.fine}</td>
            <td>${statusBadge}</td>
          `;
          
          userTicketsTable.appendChild(row);
        });
      }
      
      // Filter permits (placeholder)
      function filterPermits() {
        alert('Filter functionality for permits would be implemented here');
      }
      
      // Search permits (placeholder)
      function searchPermits() {
        const searchTerm = prompt('Enter permit ID or event to search:');
        if(searchTerm) {
          alert(`Would search for: ${searchTerm}`);
        }
      }
      
      // Filter tickets (placeholder)
      function filterTickets() {
        alert('Filter functionality for tickets would be implemented here');
      }
      
      // Search tickets (placeholder)
      function searchTickets() {
        const searchTerm = prompt('Enter ticket ID or violation to search:');
        if(searchTerm) {
          alert(`Would search for: ${searchTerm}`);
        }
      }
      
      // Initialize with user permits if on that tab
      document.addEventListener('DOMContentLoaded', function() {
        if(document.getElementById('user_status').style.display === 'block') {
          loadUserPermits();
          loadUserTickets();
        }
        
        if(document.getElementById('ticket_log').style.display === 'block') {
          loadRecentTickets();
        }
      });
      
      // Profile dropdown functionality
      document.getElementById("profile-btn").addEventListener("click", function (event) {
        event.preventDefault();
        document.getElementById("dropdown-menu").classList.toggle("show");
      });
      
      document.addEventListener("click", function (event) {
        if (!document.getElementById("profile-btn").contains(event.target)) {
          document.getElementById("dropdown-menu").classList.remove("show");
        }
      });
      
      // Avatar modal functionality
      var modal = document.getElementById("avatarModal");
      var img = document.getElementById("profileAvatar");
      var modalImg = document.getElementById("modalImage");
      
      img.onclick = function () {
        modal.style.display = "block";
        modalImg.src = this.src;
      };
      
      var span = document.getElementsByClassName("close")[0];
      span.onclick = function () {
        modal.style.display = "none";
      };
      
      modal.onclick = function (event) {
        if (event.target === modal) {
          modal.style.display = "none";
        }
      };
      
      // Avatar click animation
      document.getElementById("profileAvatar").addEventListener("click", function () {
        this.style.transform = "scale(0.95)";
        setTimeout(() => {
          this.style.transform = "scale(1)";
        }, 200);
      });
    </script>
  </body>
</html>